(function() {
  "use strict";
  
  var KFOOT_TOGGLE = "[data-kfoot-toggle]";
  var KFOOT_EXPANDED = "[data-kfoot-open]";
  var KFOOT_GROUP = "[data-kfoot-group]";

  kifi_footer_each(get_groups(), function(group, i) {
    get_button(group).addEventListener("click", function(event) {
      kifi_footer_each(get_groups(true), set_expanded);
      set_expanded(group, !is_expanded(group));
    });
  });

  function kifi_footer_each(items, callback) {
    for (var i = 0; i < items.length; i++) {
      callback(items[i]);
    }
  }

  function set_expanded(group, state) {
    var attr = KFOOT_EXPANDED.substring(1, KFOOT_EXPANDED.length - 1);
    if (state) {
      group.setAttribute(attr, "");
      get_button(group).setAttribute("aria-expanded", "true");
    } else {
      group.removeAttribute(attr);
      get_button(group).setAttribute("aria-expanded", "false");
    }
  }

  function is_expanded(group) {
    var attr = KFOOT_EXPANDED.substring(1, KFOOT_EXPANDED.length - 1);
    return group.hasAttribute(attr);
  }

  function get_groups(only_expanded) {
    return document.querySelectorAll("#kifi-footer " + KFOOT_GROUP + (only_expanded ? KFOOT_EXPANDED : ""));
  }

  function get_button(group) {
    return group.querySelector(KFOOT_TOGGLE);
  }
}());
